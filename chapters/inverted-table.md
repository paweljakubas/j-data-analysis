# Inverted table

## Contents
1. [Why to use inverted table](#rationale-behind-using-inverted-table)
2. [Take selected rows via index](#use-index-to-select)

### Rationale behind using inverted table

Let's load bond data in a boxed form and as inverted table and compare memory footprint
```j
   ]bonds=: toTableFromCSV './datasets/bonds.csv'
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-05-30│-0.0860│1Y   │JP     │
│2022-05-31│-0.0840│1Y   │JP     │
│2022-06-01│-0.0840│1Y   │JP     │
│2022-06-02│-0.0860│1Y   │JP     │
│2022-06-03│-0.0830│1Y   │JP     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-13│-0.0640│1Y   │JP     │
│2022-06-14│-0.0820│1Y   │JP     │
│2022-06-15│-0.0860│1Y   │JP     │
│2022-06-16│-0.1060│1Y   │JP     │
│2022-06-17│-0.0950│1Y   │JP     │
│2022-05-30│0.0000 │5Y   │JP     │
│2022-05-31│0.0040 │5Y   │JP     │
│2022-06-01│-0.0040│5Y   │JP     │
│2022-06-02│0.0000 │5Y   │JP     │
│2022-06-03│-0.0090│5Y   │JP     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-13│0.0350 │5Y   │JP     │
│2022-06-14│0.0700 │5Y   │JP     │
│2022-06-15│0.0700 │5Y   │JP     │
│2022-06-16│0.0380 │5Y   │JP     │
│2022-06-17│0.0480 │5Y   │JP     │
│2022-05-30│0.2300 │10Y  │JP     │
│2022-05-31│0.2410 │10Y  │JP     │
│2022-06-01│0.2350 │10Y  │JP     │
│2022-06-02│0.2400 │10Y  │JP     │
│2022-06-03│0.2350 │10Y  │JP     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-13│0.2550 │10Y  │JP     │
│2022-06-14│0.2560 │10Y  │JP     │
│2022-06-15│0.2520 │10Y  │JP     │
│2022-06-16│0.2510 │10Y  │JP     │
│2022-06-17│0.2250 │10Y  │JP     │
│2022-05-31│2.0530 │1Y   │US     │
│2022-06-01│2.1230 │1Y   │US     │
│2022-06-02│2.1260 │1Y   │US     │
│2022-06-03│2.1620 │1Y   │US     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-13│2.7990 │1Y   │US     │
│2022-06-14│3.0520 │1Y   │US     │
│2022-06-15│2.9640 │1Y   │US     │
│2022-06-16│2.8850 │1Y   │US     │
│2022-06-17│2.8870 │1Y   │US     │
│2022-05-30│2.8053 │5Y   │US     │
│2022-05-31│2.8207 │5Y   │US     │
│2022-06-01│2.9160 │5Y   │US     │
│2022-06-02│2.9111 │5Y   │US     │
│2022-06-03│2.9371 │5Y   │US     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-13│3.4820 │5Y   │US     │
│2022-06-14│3.6013 │5Y   │US     │
│2022-06-15│3.3734 │5Y   │US     │
│2022-06-16│3.2860 │5Y   │US     │
│2022-06-17│3.3436 │5Y   │US     │
│2022-05-30│2.8097 │10Y  │US     │
│2022-05-31│2.8495 │10Y  │US     │
│2022-06-01│2.9113 │10Y  │US     │
│2022-06-02│2.9131 │10Y  │US     │
│2022-06-03│2.9405 │10Y  │US     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-10│3.1649 │10Y  │US     │
│2022-06-13│3.3617 │10Y  │US     │
│2022-06-14│3.4791 │10Y  │US     │
│2022-06-15│3.2915 │10Y  │US     │
│2022-06-16│3.1952 │10Y  │US     │
│2022-06-17│3.2313 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
   ]bondsGrid=: toGridFromCSV './datasets/bonds.csv'
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-05-30│-0.0860│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│-0.0840│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│-0.0840│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│-0.0860│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│-0.0830│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0800│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│-0.0830│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│-0.0850│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│-0.0830│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│-0.0900│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│-0.0640│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│-0.0820│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│-0.0860│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│-0.1060│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│-0.0950│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│0.0000 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│0.0040 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│-0.0040│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│0.0000 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│-0.0090│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0040│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│0.0000 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│-0.0100│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│-0.0100│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│-0.0040│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│0.0350 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│0.0700 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│0.0700 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│0.0380 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│0.0480 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│0.2300 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│0.2410 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│0.2350 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│0.2400 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│0.2350 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│0.2400 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│0.2450 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│0.2450 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│0.2490 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│0.2500 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│0.2550 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│0.2560 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│0.2520 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│0.2510 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│0.2250 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│2.0530 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│2.1230 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│2.1260 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│2.1620 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│2.1960 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│2.2060 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│2.2450 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│2.3000 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│2.5070 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│2.7990 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.0520 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│2.9640 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│2.8850 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│2.8870 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│2.8053 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│2.8207 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│2.9160 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│2.9111 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│2.9371 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│3.0368 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│2.9906 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│3.0355 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│3.0702 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│3.2637 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│3.4820 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.6013 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│3.3734 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│3.2860 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.3436 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│2.8097 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│2.8495 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│2.9113 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│2.9131 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│2.9405 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│3.0399 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│2.9791 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│3.0270 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│3.0455 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│3.1649 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│3.3617 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.4791 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│3.2915 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│3.1952 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.2313 │10Y  │US     │
└──────────┴───────┴─────┴───────┘

   NB. let' see how much each data object occupies
   7!:5 ;: 'bonds bondsGrid'
3840 50176
```

Inverted table is very efficient as a data structure when heterogeneous columns are to be stored.
In the example above the difference in favor of the inverted table is one order of magnitude. Hence,
the inverted table will be a way we will represent heterogeneous columns.

Let's see how we can realize useful operations on that.
What will follow is inspired by [https://code.jsoftware.com/wiki/Essays/Inverted_Table] and
[https://code.jsoftware.com/wiki/User:Pascal_Jasmin/tuples-ranked_operations_on_inverted_table_data].


### Use index to select
```j
   NB. Take first three rows
   (({.),((<0 1 2) {&.> }.)) bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-05-30│-0.0860│1Y   │JP     │
│2022-05-31│-0.0840│1Y   │JP     │
│2022-06-01│-0.0840│1Y   │JP     │
└──────────┴───────┴─────┴───────┘

   NB. Take last three rows
   (({.),((<_1 _2 _3) {&.> }.)) bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.2313 │10Y  │US     │
│2022-06-16│3.1952 │10Y  │US     │
│2022-06-15│3.2915 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
```
