# Inverted table

## Contents
1. [Why to use inverted table](#rationale-behind-using-inverted-table)
2. [Select rows via index](#use-index-to-select-rows)
3. [Filter columns](#filter-columns)
4. [Order rows](#order-rows)
5. [Update column](#update-column)
6. [Add column](#add-column)
6. [Collapse data and rotate dataframe](#collapse-data)
7. [Work with two inverted tables](#two-tables)


### Rationale behind using inverted table

Let's load bond data in a boxed form and as inverted table and compare memory footprint
```j
   ]bonds=: toTableFromCSV './datasets/bonds.csv'
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-05-30│-0.0860│1Y   │JP     │
│2022-05-31│-0.0840│1Y   │JP     │
│2022-06-01│-0.0840│1Y   │JP     │
│2022-06-02│-0.0860│1Y   │JP     │
│2022-06-03│-0.0830│1Y   │JP     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-13│-0.0640│1Y   │JP     │
│2022-06-14│-0.0820│1Y   │JP     │
│2022-06-15│-0.0860│1Y   │JP     │
│2022-06-16│-0.1060│1Y   │JP     │
│2022-06-17│-0.0950│1Y   │JP     │
│2022-05-30│0.0000 │5Y   │JP     │
│2022-05-31│0.0040 │5Y   │JP     │
│2022-06-01│-0.0040│5Y   │JP     │
│2022-06-02│0.0000 │5Y   │JP     │
│2022-06-03│-0.0090│5Y   │JP     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-13│0.0350 │5Y   │JP     │
│2022-06-14│0.0700 │5Y   │JP     │
│2022-06-15│0.0700 │5Y   │JP     │
│2022-06-16│0.0380 │5Y   │JP     │
│2022-06-17│0.0480 │5Y   │JP     │
│2022-05-30│0.2300 │10Y  │JP     │
│2022-05-31│0.2410 │10Y  │JP     │
│2022-06-01│0.2350 │10Y  │JP     │
│2022-06-02│0.2400 │10Y  │JP     │
│2022-06-03│0.2350 │10Y  │JP     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-13│0.2550 │10Y  │JP     │
│2022-06-14│0.2560 │10Y  │JP     │
│2022-06-15│0.2520 │10Y  │JP     │
│2022-06-16│0.2510 │10Y  │JP     │
│2022-06-17│0.2250 │10Y  │JP     │
│2022-05-31│2.0530 │1Y   │US     │
│2022-06-01│2.1230 │1Y   │US     │
│2022-06-02│2.1260 │1Y   │US     │
│2022-06-03│2.1620 │1Y   │US     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-13│2.7990 │1Y   │US     │
│2022-06-14│3.0520 │1Y   │US     │
│2022-06-15│2.9640 │1Y   │US     │
│2022-06-16│2.8850 │1Y   │US     │
│2022-06-17│2.8870 │1Y   │US     │
│2022-05-30│2.8053 │5Y   │US     │
│2022-05-31│2.8207 │5Y   │US     │
│2022-06-01│2.9160 │5Y   │US     │
│2022-06-02│2.9111 │5Y   │US     │
│2022-06-03│2.9371 │5Y   │US     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-13│3.4820 │5Y   │US     │
│2022-06-14│3.6013 │5Y   │US     │
│2022-06-15│3.3734 │5Y   │US     │
│2022-06-16│3.2860 │5Y   │US     │
│2022-06-17│3.3436 │5Y   │US     │
│2022-05-30│2.8097 │10Y  │US     │
│2022-05-31│2.8495 │10Y  │US     │
│2022-06-01│2.9113 │10Y  │US     │
│2022-06-02│2.9131 │10Y  │US     │
│2022-06-03│2.9405 │10Y  │US     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-10│3.1649 │10Y  │US     │
│2022-06-13│3.3617 │10Y  │US     │
│2022-06-14│3.4791 │10Y  │US     │
│2022-06-15│3.2915 │10Y  │US     │
│2022-06-16│3.1952 │10Y  │US     │
│2022-06-17│3.2313 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
   ]bondsGrid=: toGridFromCSV './datasets/bonds.csv'
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-05-30│-0.0860│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│-0.0840│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│-0.0840│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│-0.0860│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│-0.0830│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0800│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│-0.0830│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│-0.0850│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│-0.0830│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│-0.0900│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│-0.0640│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│-0.0820│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│-0.0860│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│-0.1060│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│-0.0950│1Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│0.0000 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│0.0040 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│-0.0040│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│0.0000 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│-0.0090│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0040│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│0.0000 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│-0.0100│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│-0.0100│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│-0.0040│5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│0.0350 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│0.0700 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│0.0700 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│0.0380 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│0.0480 │5Y   │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│0.2300 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│0.2410 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│0.2350 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│0.2400 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│0.2350 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│0.2400 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│0.2450 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│0.2450 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│0.2490 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│0.2500 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│0.2550 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│0.2560 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│0.2520 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│0.2510 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│0.2250 │10Y  │JP     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│2.0530 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│2.1230 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│2.1260 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│2.1620 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│2.1960 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│2.2060 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│2.2450 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│2.3000 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│2.5070 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│2.7990 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.0520 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│2.9640 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│2.8850 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│2.8870 │1Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│2.8053 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│2.8207 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│2.9160 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│2.9111 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│2.9371 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│3.0368 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│2.9906 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│3.0355 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│3.0702 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│3.2637 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│3.4820 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.6013 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│3.3734 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│3.2860 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.3436 │5Y   │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-30│2.8097 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-05-31│2.8495 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-01│2.9113 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-02│2.9131 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-03│2.9405 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-06│3.0399 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-07│2.9791 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-08│3.0270 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-09│3.0455 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-10│3.1649 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-13│3.3617 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.4791 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-15│3.2915 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-16│3.1952 │10Y  │US     │
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.2313 │10Y  │US     │
└──────────┴───────┴─────┴───────┘

   NB. let's see how much each data object occupies space in bytes
   7!:5 ;: 'bonds bondsGrid'
3840 50176
```

Inverted table is very efficient as a data structure when heterogeneous columns are to be stored.
In the example above the difference favoring the inverted table is one order of magnitude. Hence,
the inverted table will be a way we will represent heterogeneous columns and try to master.

Let's see how we can realize useful operations on that.
What will follow is inspired by [https://code.jsoftware.com/wiki/Essays/Inverted_Table] and
[https://code.jsoftware.com/wiki/User:Pascal_Jasmin/tuples-ranked_operations_on_inverted_table_data].


### Use index to select rows
```j
   NB. Take first three rows which replicates could head
   (({.),((<0 1 2) {&.> }.)) bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-05-30│-0.0860│1Y   │JP     │
│2022-05-31│-0.0840│1Y   │JP     │
│2022-06-01│-0.0840│1Y   │JP     │
└──────────┴───────┴─────┴───────┘

   NB. Take last three rows
   (({.),((<_1 _2 _3) {&.> }.)) bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.2313 │10Y  │US     │
│2022-06-16│3.1952 │10Y  │US     │
│2022-06-15│3.2915 │10Y  │US     │
└──────────┴───────┴─────┴───────┘

   NB. Or using functionality from j/analysis.ijs
   (_1,2) rowsFromTable bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-17│3.2313 │10Y  │US     │
│2022-06-01│-0.0840│1Y   │JP     │
└──────────┴───────┴─────┴───────┘

   NB. We want to also see some number of random rows
   ]nrows=: >{.{.#&.>}.bonds
89
   5?nrows
55 79 63 88 42
   (5?nrows) rowsFromTable bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-14│3.0520 │1Y   │US     │
│2022-06-15│-0.0860│1Y   │JP     │
│2022-06-02│0.0000 │5Y   │JP     │
│2022-06-03│-0.0090│5Y   │JP     │
│2022-06-14│0.0700 │5Y   │JP     │
└──────────┴───────┴─────┴───────┘

   NB. Also using functionality from j/analysis.ijs
   3 randomRowsFromTable bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-15│0.2520 │10Y  │JP     │
│2022-06-02│2.9131 │10Y  │US     │
│2022-06-09│0.2490 │10Y  │JP     │
└──────────┴───────┴─────┴───────┘
```

### Filter columns

Let's say we want to filter out all rows that have quotes less than 3.4.
What we can do to achieve that is to specify row indices that have `quote >= 3.4`.
```j
   3.4 <: ". >(<(<0),(<1)){ }.bonds
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0
   ]ixs=: (3.4 <: ". (>(<(<0),(<1)){ }.bonds) ) # i.nrows
69 70 85
   NB. Notice ". which converts string to numbers (if possible)

   ixs rowsFromTable bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-13│3.4820 │5Y   │US     │
│2022-06-14│3.6013 │5Y   │US     │
│2022-06-14│3.4791 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
```

What is we request `quote >= 3.4` but only for 5y tenor, ie., `tenor == 5Y` .
```j
   ]ixs1=: 3.4 <: ". >(<(<0),(<1)){ }.bonds
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0

   NB. Notice ;: which forms words, value in predicate needs to be boxed to be comparable
   ]ixs2=: (<'5Y') = ,;: >(<(<0),(<2)){ }.bonds
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0

   NB. now we can fuse ixs1 and ixs2 through *. (AND operator)
   ]ixs=: ixs1 *. ixs2
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
   ]ixss=: ixs # i.nrows
69 70
   ixss rowsFromTable bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-13│3.4820 │5Y   │US     │
│2022-06-14│3.6013 │5Y   │US     │
└──────────┴───────┴─────┴───────┘
```

Now let's request data slice for trading week from 2022-06-06 to 2022-06-10.
```j
   NB. let's take the above filter as an example to illustrate what is going on
   res=: ixss rowsFromTable bonds
   ;: >(<(<0),(<0)){ }. res
┌────┬─┬──┬─┬──┐
│2022│-│06│-│13│
├────┼─┼──┼─┼──┤
│2022│-│06│-│14│
└────┴─┴──┴─┴──┘
   NB. the first column is extracted and interpreted 5-word tokens.

   {{4{y}}"1;:>(<(<0),(<0)){ }. res
┌──┬──┐
│13│14│
└──┴──┘

   NB. Still we have byte represented symbols boxed. We can convert this to numbers
   {{".>4{y}}"1;:>(<(<0),(<0)){ }. res
13 14

   NB. Now we can impose predicates in the inline functionality.
   ]ixs=: {{(6 = ".>2{y) *. ((6,7,8,9,10) e.~ ".>4{y)}}"1;:>(<(<0),(<0)){ }. bonds
0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0 0
   ]ixss=: ixs # i.nrows
5 6 7 8 9 20 21 22 23 24 35 36 37 38 39 49 50 51 52 53 64 65 66 67 68 79 80 81 82 83
   ]week=: ixss rowsFromTable bonds
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-10│3.1649 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
```

### Order rows
The another useful task is ability to order by column. We can order by column using "/:" or "\\:"
```j
   ]ixs=: /: ;: >(<(<0),(<0)){ }. week
0 5 10 15 20 25 1 6 11 16 21 26 2 7 12 17 22 27 3 8 13 18 23 28 4 9 14 19 24 29
   ixs rowsFromTable week
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-10│3.1649 │10Y  │US     │
└──────────┴───────┴─────┴───────┘

   ]ixs=: \: ;: >(<(<0),(<0)){ }. week
4 9 14 19 24 29 3 8 13 18 23 28 2 7 12 17 22 27 1 6 11 16 21 26 0 5 10 15 20 25
   ixs rowsFromTable week
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-10│3.1649 │10Y  │US     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-06│3.0399 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
```

For the sake of ordering with more than 1 column (so first order by column1 then finetune with column2 ordering, etc.)
we will introduce `ranking` as follows:
```j
   ranking=: i.!.0~ { /:@/:
   ranking&> }.week
 0  6 12 18 24  0  6 12 18 24  0  6 12 18 24  0  6 12 18 24  0  6 12 18 24  0  6 12 18 24
 4  5  7  5  8  0  9  2  2  0 10 11 11 13 14 15 16 17 18 19 24 21 23 27 29 25 20 22 26 28
10 10 10 10 10 20 20 20 20 20  0  0  0  0  0 10 10 10 10 10 20 20 20 20 20  0  0  0  0  0
 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 15 15 15 15 15 15 15 15 15 15 15 15 15 15 15
```
Upon a close look we can discern patterns reflecting data columns represented in ranking row-wise.

```j
   tgrade=: /: @ |: @: (ranking&>)
   tsort=: <@tgrade {&.> ]
   ,.&.> tsort }. week
┌──────────┬───────┬───┬──┐
│2022-06-06│-0.0040│5Y │JP│
│2022-06-06│-0.0800│1Y │JP│
│2022-06-06│0.2400 │10Y│JP│
│2022-06-06│2.1960 │1Y │US│
│2022-06-06│3.0368 │5Y │US│
│2022-06-06│3.0399 │10Y│US│
│2022-06-07│-0.0830│1Y │JP│
│2022-06-07│0.0000 │5Y │JP│
│2022-06-07│0.2450 │10Y│JP│
│2022-06-07│2.2060 │1Y │US│
│2022-06-07│2.9791 │10Y│US│
│2022-06-07│2.9906 │5Y │US│
│2022-06-08│-0.0100│5Y │JP│
│2022-06-08│-0.0850│1Y │JP│
│2022-06-08│0.2450 │10Y│JP│
│2022-06-08│2.2450 │1Y │US│
│2022-06-08│3.0270 │10Y│US│
│2022-06-08│3.0355 │5Y │US│
│2022-06-09│-0.0100│5Y │JP│
│2022-06-09│-0.0830│1Y │JP│
│2022-06-09│0.2490 │10Y│JP│
│2022-06-09│2.3000 │1Y │US│
│2022-06-09│3.0455 │10Y│US│
│2022-06-09│3.0702 │5Y │US│
│2022-06-10│-0.0040│5Y │JP│
│2022-06-10│-0.0900│1Y │JP│
│2022-06-10│0.2500 │10Y│JP│
│2022-06-10│2.5070 │1Y │US│
│2022-06-10│3.1649 │10Y│US│
│2022-06-10│3.2637 │5Y │US│
└──────────┴───────┴───┴──┘

  NB. the same with header attached
   (({.),((,.&.>) @ (tsort @ }.))) week
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-10│3.1649 │10Y  │US     │
│2022-06-10│3.2637 │5Y   │US     │
└──────────┴───────┴─────┴───────┘
```
We see that table was ordered by `date` column at first. Then within the same `date` value
rows are ordered by `quote` value in ascending order (but in lexicographical sense!). As they are unique the ordering by the rest
columns is omitted.

We might want more fine-grained control over ordering. For example, we might request to
order `date` by ascending order and within the same values of `date` order further via `tenor`.
In order to achieve that we need to change how ranking matrix looks like.
```j
   ]ranking1=: ((<(<0),(<0)){ranking&> }.week) ,0, ((<(<0),(<2)){ranking&> }.week) ,: 0
 0  6 12 18 24  0  6 12 18 24 0 6 12 18 24  0  6 12 18 24  0  6 12 18 24 0 6 12 18 24
 0  0  0  0  0  0  0  0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0 0 0  0  0  0
10 10 10 10 10 20 20 20 20 20 0 0  0  0  0 10 10 10 10 10 20 20 20 20 20 0 0  0  0  0
 0  0  0  0  0  0  0  0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0 0 0  0  0  0

   NB. so we left ranking only for date and for tenor.
   tgrade=: /: @ |: @: {{ranking1}}
   tsort=: <@tgrade {&.> ]
   (({.),((,.&.>) @ (tsort @ }.))) week
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-10│3.1649 │10Y  │US     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-10│3.2637 │5Y   │US     │
└──────────┴───────┴─────┴───────┘
```

What if we want to ensure ascending ordering for `date` and descending for `tenor`. Once again we can manufacture
ranking matrix.
```j
   rankingAsc=: i.!.0~ { /:@/:
   rankingDesc=: i.!.0~ { /:@\:
   ]ranking2=: ((<(<0),(<0)){rankingAsc&> }.week) ,0, ((<(<0),(<2)){rankingDesc&> }.week) ,: 0
 0  6 12 18 24 0 6 12 18 24  0  6 12 18 24  0  6 12 18 24 0 6 12 18 24  0  6 12 18 24
 0  0  0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0 0 0  0  0  0  0  0  0  0  0
10 10 10 10 10 0 0  0  0  0 20 20 20 20 20 10 10 10 10 10 0 0  0  0  0 20 20 20 20 20
 0  0  0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0 0 0  0  0  0  0  0  0  0  0

   NB. Notice we created first row from ascending ranking and third from descending ranking
   $ranking2
4 30
   ranking2 orderFromRanking week
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-10│2.5070 │1Y   │US     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-10│3.1649 │10Y  │US     │
└──────────┴───────┴─────┴───────┘
   NB. the functions are also defined in j/algebra.ijs
```

We are almost there when it comes to ordering. We see tenor is ordered as `10Y - 1Y - 5Y` or
`5Y - 1Y - 10Y` which lexicographically is correct but we may want to introduce custom ordering like `1Y - 5Y - 10Y`
to cover time relation ('1Y' stands for one year, and so on).
In order to do that we need to construct ranking matrix based on this custom ordering.

```j
   ]source=: >(<(<0),(<2)){ }. week
1Y
1Y
1Y
1Y
1Y
5Y
5Y
5Y
5Y
5Y
10Y
10Y
10Y
10Y
10Y
1Y
1Y
1Y
1Y
1Y
5Y
5Y
5Y
5Y
5Y
10Y
10Y
10Y
10Y
10Y
   $source
30 3

   NB. Grade y up according to key x
   gradeUp=: /:@i.
   ]ixs=: 'abc' gradeUp 'abbca'
0 4 1 2 3
   ixs { 'abbca'
aabbc

   NB. Rank y rising, 0-origin, ties equal
   rankUp=: i.~/:~
   rankUp ixs { 'abbca'
0 0 2 2 4

   ]ord=: '10Y','5Y ',:'1Y '
10Y
5Y
1Y

   ord gradeUp source
10 11 12 13 14 25 26 27 28 29 5 6 7 8 9 20 21 22 23 24 0 1 2 3 4 15 16 17 18 19
   (ord gradeUp source) { source
10Y
10Y
10Y
10Y
10Y
10Y
10Y
10Y
10Y
10Y
5Y
5Y
5Y
5Y
5Y
5Y
5Y
5Y
5Y
5Y
1Y
1Y
1Y
1Y
1Y
1Y
1Y
1Y
1Y
1Y

   ]customRankingTenor =: source i.~ ((ord gradeUp source) { source)
20 20 20 20 20 10 10 10 10 10 0 0 0 0 0 20 20 20 20 20 10 10 10 10 10 0 0 0 0 0
   ]ranking3=: ((<(<0),(<0)){rankingAsc&> }.week) ,0, customRankingTenor ,: 0
 0  6 12 18 24  0  6 12 18 24 0 6 12 18 24  0  6 12 18 24  0  6 12 18 24 0 6 12 18 24
 0  0  0  0  0  0  0  0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0 0 0  0  0  0
20 20 20 20 20 10 10 10 10 10 0 0  0  0  0 20 20 20 20 20 10 10 10 10 10 0 0  0  0  0
 0  0  0  0  0  0  0  0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0 0 0  0  0  0
   ranking3 orderFromRanking week
┌──────────┬───────┬─────┬───────┐
│date      │quote  │tenor│country│
├──────────┼───────┼─────┼───────┤
│2022-06-06│0.2400 │10Y  │JP     │
│2022-06-06│3.0399 │10Y  │US     │
│2022-06-06│-0.0040│5Y   │JP     │
│2022-06-06│3.0368 │5Y   │US     │
│2022-06-06│-0.0800│1Y   │JP     │
│2022-06-06│2.1960 │1Y   │US     │
│2022-06-07│0.2450 │10Y  │JP     │
│2022-06-07│2.9791 │10Y  │US     │
│2022-06-07│0.0000 │5Y   │JP     │
│2022-06-07│2.9906 │5Y   │US     │
│2022-06-07│-0.0830│1Y   │JP     │
│2022-06-07│2.2060 │1Y   │US     │
│2022-06-08│0.2450 │10Y  │JP     │
│2022-06-08│3.0270 │10Y  │US     │
│2022-06-08│-0.0100│5Y   │JP     │
│2022-06-08│3.0355 │5Y   │US     │
│2022-06-08│-0.0850│1Y   │JP     │
│2022-06-08│2.2450 │1Y   │US     │
│2022-06-09│0.2490 │10Y  │JP     │
│2022-06-09│3.0455 │10Y  │US     │
│2022-06-09│-0.0100│5Y   │JP     │
│2022-06-09│3.0702 │5Y   │US     │
│2022-06-09│-0.0830│1Y   │JP     │
│2022-06-09│2.3000 │1Y   │US     │
│2022-06-10│0.2500 │10Y  │JP     │
│2022-06-10│3.1649 │10Y  │US     │
│2022-06-10│-0.0040│5Y   │JP     │
│2022-06-10│3.2637 │5Y   │US     │
│2022-06-10│-0.0900│1Y   │JP     │
│2022-06-10│2.5070 │1Y   │US     │
└──────────┴───────┴─────┴───────┘

  NB. We have table sorted first by date in ascending order, then by tenor by custom order '10Y - 5Y - 1Y'
```

### Update column
### Add column
### Collapse data
### Two tables
